<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Page</title>
    <link rel="stylesheet" href="/styles.css">
    <script>
        function timeAgo(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) {
                return days + '일 전';
            } else if (hours > 0) {
                return hours + '시간 전';
            } else if (minutes > 0) {
                return minutes + '분 전';
            } else {
                return seconds + '초 전';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.write-time').forEach(element => {
                const date = element.getAttribute('data-time');
                element.textContent = timeAgo(date);
            });
        });
    </script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/noticeboard">Noticeboard</a></li>
                <li><a href="/trainers">Trainers</a></li>
                <li><a href="/myinfo">My Info</a></li>
                <li><a href="/dogencyclopedia">Dog Encyclopedia</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h2>자유게시판</h2>
        <button type="button" onclick="location.href='/noticeboard/form'">글 쓰기</button>  
        <form id="sortForm" method="GET" action="/noticeboard">
            <select name="order" id="order" onchange="document.getElementById('sortForm').submit()">
                <option value="latest" <% if (order === 'latest') { %>selected<% } %>>최신순</option>
                <option value="fav" <% if (order === 'fav') { %>selected<% } %>>인기순</option>
                <option value="view" <% if (order === 'view') { %>selected<% } %>>조회순</option>
            </select>
        </form>        
        <div class="content">
            <table>
                <tr>
                    <th>프로필</th>
                    <th>제목</th>
                    <th>내용</th>
                    <th>작성 시간</th>
                    <th>댓글 수</th>
                    <th>좋아요 수</th>
                    <th>조회수</th> 
                    <!-- <th>Update Time</th> -->
                </tr>
                <% noticeboard.forEach((post) => { %>
                    <tr>
                        <td><%= post.nick_name %></td>
                        <td><a href="/noticeboard/<%= post.post_id %>"><%= post.title %></a></td>
                        <td>
                            <script>
                                function truncateText(text, maxLength) {
                                    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                                }
                                document.write(truncateText('<%= post.description %>', 10)); // 내용을 10글자만 보이게함.
                            </script>
                        </td>
                        <td class="write-time" data-time="<%= post.write_time %>"><%= new Date(post.write_time).toLocaleString() %></td>
                        <!-- <td><%= new Date(post.update_time).toLocaleString() %></td> -->
                        <td><p><%= post.totalCommentsCount %></p></td>
                        <td><p><%= post.likeCount %></p></td>
                        <td><p><%= post.view_count %></p></td>
                    </tr>
                <% }); %>
            </table>
        </div>

        <!--페이지네이션-->
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/noticeboard?page=<%= currentPage - 1 %>&order=<%= order %>">이전</a>
            <% } %>
            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/noticeboard?page=<%= i %>&order=<%= order %>" <% if (i === currentPage) { %>class="active"<% } %>><%= i %></a>
            <% } %>
            <% if (currentPage < totalPages) { %>
                <a href="/noticeboard?page=<%= currentPage + 1 %>&order=<%= order %>">다음</a>
            <% } %>
        </div>
    </div>
</body>
</html>
